{% extends 'base.html' %}

{% block content %}

<style>
    /* Esto asegura que el fondo sea negro en lugar de la imagen del bosque */
    body.fondo {
    
        background-color: #000000 !important; /* Ponemos negro */
        color: #ffffff;
    }
    .card {
        background-color: #1a1a1a;
        color: #ffffff;
    }
    .card-header {
        font-weight: bold;
    }
    /* Ajustes para el modal */
    .modal-backdrop { z-index: 1040; }
    .modal { z-index: 1050; }
</style>

<div class="container-fluid" style="padding-top: 100px; padding-bottom: 40px;">
    <div class="content-box p-4 mx-auto" style="max-width: 800px;">
        <h1 class="text-center mb-5">Planes de Membresía</h1>

        <div class="card mb-4 border border-secondary">
            <div class="card-header bg-secondary text-white text-center">Plan Gratuito</div>
            <div class="card-body">
                <p>Acceso completo a la información de rutas sin búsqueda avanzada.</p>
                <ul class="list-unstyled">
                    <li>✔ Ver tarifa, paradas y mapa de todas las rutas</li>
                    <li>✖ Búsqueda de rutas por nombre</li>
                    <li>✖ Herramienta ¿A dónde voy?</li>
                    <li>✖ Descarga de reportes</li>
                </ul>
                <p class="fw-bold text-center mt-3">Precio: $0/mes</p>
            </div>
        </div>

        <div class="card mb-4 border border-primary">
            <div class="card-header bg-primary text-white text-center">Premium Básico</div>
            <div class="card-body">
                <p>Ideal para usuarios que necesitan búsqueda avanzada de rutas.</p>
                <ul class="list-unstyled">
                    <li>✔ Ver tarifa, paradas y mapa de todas las rutas</li>
                    <li>✔ Búsqueda de rutas por nombre, origen y destino</li>
                    <li>✖ Herramienta ¿A dónde voy?</li>
                    <li>✖ Descarga de reportes</li>
                </ul>
                <p class="fw-bold text-center mt-3">Precio: $2.99/mes</p>
            </div>
        </div>

        <div class="card mb-4 border border-success">
            <div class="card-header bg-success text-white text-center">Premium Avanzado</div>
            <div class="card-body">
                <p>Para quienes necesitan acceso completo incluyendo búsqueda avanzada por GPS.</p>
                <ul class="list-unstyled">
                    <li>✔ Ver tarifa, paradas y mapa de todas las rutas</li>
                    <li>✔ Búsqueda de rutas por nombre, origen y destino</li>
                    <li>✔ Herramienta ¿A dónde voy? (búsqueda manual y GPS)</li>
                    <li>✔ Descarga de reportes en PDF</li>
                </ul>
                <p class="fw-bold text-center mt-3">Precio: $6.99/mes</p>
            </div>
        </div>

        <div class="card mb-4 border border-light">
            <div class="card-header bg-dark text-white text-center">Premium Familiar</div>
            <div class="card-body">
                <p>Diseñado para familias, amigos o conocidos con necesidades especiales.</p>
                <ul class="list-unstyled">
                    <li>✔ Acceso completo a todos los datos y herramientas</li>
                    <li>✔ Herramienta ¿A dónde voy? con búsqueda manual y GPS</li>
                    <li>✔ Descarga de reportes ilimitados</li>
                    <li>✔ Soporte técnico prioritario</li>
                </ul>
                <p class="fw-bold text-center mt-3">Precio: $29.99/mes</p>
            </div>
        </div>

        <div class="text-center mt-5">
            {% if user.is_authenticated %}
                <button class="btn btn-outline-light" onclick="reproducirAudioYAbrirModal()">Mejorar plan</button>
            {% else %}
                <a href="{% url 'iniciar_sesion' %}" class="btn btn-outline-light">Mejorar plan</a>
            {% endif %}
        </div>
    </div>
</div>

<div class="modal fade" id="formularioPago" tabindex="-1" aria-labelledby="formularioPagoLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header">
                <h5 class="modal-title" id="formularioPagoLabel">Mejorar tu plan</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <form method="POST" action="{% url 'upgrade_plan' %}">

                    <script>
                    document.addEventListener("DOMContentLoaded", function() {
                        {% if messages %}
                            var modal = new bootstrap.Modal(document.getElementById('formularioPago'));
                            modal.show();
                        {% endif %}
                    });
                    </script>

                    {% if user.is_authenticated %}
                        {% csrf_token %}

                        {% if messages %}
                          {% for message in messages %}
                            <div class="alert {% if message.tags == 'error' %}alert-danger{% else %}alert-success{% endif %} text-center mb-3" role="alert">
                              {{ message }}
                            </div>
                          {% endfor %}
                        {% endif %}

                        <div class="mb-3">
                            <label for="plan" class="form-label">Selecciona tu plan</label>
                            <select class="form-select" id="plan" name="plan" required>
                                <option value="">-- Elige una opción --</option>
                                <option value="Premium Básico">Premium Básico - $2.99/mes</option>
                                <option value="Premium Avanzado">Premium Avanzado - $6.99/mes</option>
                                <option value="Premium Institucional">Premium Institucional - $29.99/mes</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="nombre" class="form-label">Nombre completo</label>
                            <input type="text" class="form-control" id="nombre" name="nombre" required>
                        </div>
                        <div class="mb-3">
                            <label for="correo" class="form-label">Correo electrónico</label>
                            <input type="email" class="form-control" id="correo" name="correo" required>
                        </div>
                        <div class="mb-3">
                            <label for="tarjeta" class="form-label">Número de tarjeta</label>
                            <input type="text" class="form-control" id="tarjeta" name="tarjeta" maxlength="16" required>
                        </div>
                        <div class="mb-3">
                            <label for="vencimiento" class="form-label">Fecha de vencimiento</label>
                            <input type="month" class="form-control" id="vencimiento" name="vencimiento" required>
                        </div>
                        <div class="mb-3">
                            <label for="cvv" class="form-label">CVV</label>
                            <input type="password" class="form-control" id="cvv" name="cvv" maxlength="4" required>
                        </div>
                        <button type="submit" class="btn btn-success w-100">Confirmar y pagar</button>

                    {% else %}
                        <div class="alert alert-warning text-center mb-3" role="alert">
                          ⚠️ Debes iniciar sesión para acceder a servicios.
                        </div>
                        <div class="d-grid gap-2">
                            <a href="{% url 'iniciar_sesion' %}" class="btn btn-primary">Iniciar sesión</a>
                        </div>
                    {% endif %}

                </form>

            </div>
        </div>
    </div>
</div>

{% load static %}
<audio id="audioConfirmacion" src="{% static 'audio/auidowasaa.mp3' %}" preload="auto"></audio>

<script>
    function reproducirAudioYAbrirModal() {
        const audio = document.getElementById('audioConfirmacion');
        if (audio) {
            audio.currentTime = 0;
            audio.play().catch(error => console.log("Error al reproducir audio:", error));
        }
        const modal = new bootstrap.Modal(document.getElementById('formularioPago'));
        modal.show();
    }
</script>

{% endblock %}