{% extends 'base.html' %}
{% load static %}

{% block content %}

<link rel="stylesheet" href="{% static 'css/diserutas.css' %}">

<div class="container" style="padding-top: 110px; padding-bottom: 50px;">

    <!-- Botón volver -->
    <div class="mb-4">
        <a href="{% url 'rutas' %}" class="btn btn-outline-light rounded-pill px-4">
            ← Volver a Categorías
        </a>
    </div>

    <!-- Título -->
    <h1 class="text-center text-light fw-bold mb-4">Gestión de Rutas Urbanas</h1>
    <p class="text-center text-light lead mb-5">Visualiza todas las rutas disponibles.</p>

    <!-- Tarjetas de rutas -->
    <div class="row g-4">
        {% for ruta in rutas %}
        <div class="col-md-6">
            <div class="ruta-card" style="background-image: url(/static/img/buses/112.jpg)">
                <div class="overlay"></div>
                <div class="card-info">
                    <h3>{{ ruta.nombre_ruta }}</h3>
                    <p>Origen: {{ ruta.origen }}</p>
                    <p>Destino: {{ ruta.destino }}</p>

                    <button class="btn-custom btn-sm mt-2"
                        data-bs-toggle="modal"
                        data-bs-target="#modal{{ ruta.id }}">
                        Ver detalles
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Paginación -->
    <div class="d-flex justify-content-center mt-5">
        <nav>
            <ul class="pagination pagination-lg">
                {% if rutas.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ rutas.previous_page_number }}">Anterior</a>
                    </li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">Anterior</span></li>
                {% endif %}

                {% for num in rutas.paginator.page_range %}
                    {% if rutas.number == num %}
                        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                    {% else %}
                        <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                    {% endif %}
                {% endfor %}

                {% if rutas.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ rutas.next_page_number }}">Siguiente</a>
                    </li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">Siguiente</span></li>
                {% endif %}
            </ul>
        </nav>
    </div>

    <!-- Botón sugerencias -->
    <div class="text-center mt-5">
        <a href="#" class="btn btn-primary btn-lg">Sugerencias</a>
    </div>

</div>

<!-- Modales -->
{% for ruta in rutas %}
<div class="modal fade" id="modal{{ ruta.id }}" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content modal-dark" style="background-color: #212529; color: white;">
            <div class="modal-header border-secondary">
                <h5 class="modal-title">{{ ruta.nombre_ruta }}</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <!-- Siempre visibles -->
                <p><strong>Origen:</strong> {{ ruta.origen }}</p>
                <p><strong>Destino:</strong> {{ ruta.destino }}</p>

            <!-- Todo desde Premium Básico en adelante -->
            {% if plan != "Gratuito" %}
                     <p><strong>Tarifa:</strong> ${{ ruta.tarifa }}</p>

                 {% if ruta.paradas %}
                     <p><strong>Paradas:</strong> {{ ruta.paradas|join:", " }}</p>
                 {% endif %}

                 {% if ruta.link %}
                     <iframe src="{{ ruta.link }}" width="100%" height="500" style="border:0;" allowfullscreen loading="lazy"></iframe>
                 {% endif %}
            {% endif %}

                <!-- Solo Premium Avanzado en adelante -->
               {% if plan == "Premium Avanzado" or plan == "Premium Institucional" %}
                     <li class="nav-item">
                     <a class="nav-link" href="{% url 'reportes' %}">Reportes</a>
                     </li>
               {% endif %}


                <!-- Solo Premium Institucional -->
                {% if plan == "Premium Institucional" %}
                    {% if ruta.link %}
                        <iframe src="{{ ruta.link }}" width="100%" height="500" style="border:0;" allowfullscreen loading="lazy"></iframe>
                    {% endif %}
                {% endif %}

                <!-- Mensaje para Gratuito -->
                {% if plan == "Gratuito" %}
                    <div class="alert alert-warning mt-3">
                        ⚠️ Mejora tu plan para ver tarifa, paradas y mapa.
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endfor %}


{% endblock %}